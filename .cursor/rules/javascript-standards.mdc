---
globs: *.js
---

# JavaScriptç¼–ç è§„èŒƒ

## ä»£ç é£æ ¼

### å‘½åè§„èŒƒ
- **ç±»å**: PascalCase (å¦‚: `AlbumURLExtractor`, `V2PHParser`)
- **æ–¹æ³•å**: camelCase (å¦‚: `extractAlbumURLs`, `updateProgress`)
- **å˜é‡å**: camelCase (å¦‚: `currentParser`, `extractionProgress`)
- **å¸¸é‡**: UPPER_SNAKE_CASE (å¦‚: `BASE_URL`, `MAX_RETRIES`)
- **ç§æœ‰æ–¹æ³•**: å‰ç¼€ä¸‹åˆ’çº¿ (å¦‚: `_handleError`, `_updateUI`)

### æ–‡ä»¶ç»„ç»‡
```javascript
// 1. å¯¼å…¥/ä¾èµ–å£°æ˜
// 2. å·¥å…·å‡½æ•°
// 3. ä¸»è¦ç±»å®šä¹‰
// 4. äº‹ä»¶ç›‘å¬å™¨
// 5. åˆå§‹åŒ–ä»£ç 
```

## ç±»è®¾è®¡æ¨¡å¼

### æ ‡å‡†ç±»ç»“æ„
å‚è€ƒ[content.js](mdc:chrome-extension/content.js)ä¸­çš„`AlbumURLExtractor`ç±»ï¼š

```javascript
class ClassName {
  constructor() {
    // åˆå§‹åŒ–å±æ€§
    this.property = defaultValue;
    this.init();
  }

  init() {
    // åˆå§‹åŒ–æ–¹æ³•
  }

  // å…¬å…±æ–¹æ³•
  publicMethod() {
    // å®ç°
  }

  // ç§æœ‰æ–¹æ³•ï¼ˆå‰ç¼€ä¸‹åˆ’çº¿ï¼‰
  _privateMethod() {
    // å®ç°
  }
}
```

### ç®¡ç†å™¨æ¨¡å¼
å‚è€ƒ[popup.js](mdc:chrome-extension/popup.js)ä¸­çš„ç®¡ç†å™¨ç±»ï¼š
- `URLManager` - ç®¡ç†URLæå–å’ŒçŠ¶æ€
- `ActorManager` - ç®¡ç†æ¼”å‘˜ä¿¡æ¯æå–
- `PopupController` - æ§åˆ¶å¼¹çª—äº¤äº’

## å¼‚æ­¥å¤„ç†è§„èŒƒ

### Promiseä½¿ç”¨
```javascript
// ä¼˜å…ˆä½¿ç”¨async/await
async function extractData() {
  try {
    const result = await someAsyncOperation();
    return result;
  } catch (error) {
    console.error('æ“ä½œå¤±è´¥:', error);
    throw error;
  }
}
```

### é”™è¯¯å¤„ç†
```javascript
// æ ‡å‡†é”™è¯¯å¤„ç†æ¨¡å¼
try {
  await riskyOperation();
} catch (error) {
  console.error('âŒ æ“ä½œå¤±è´¥:', error);
  this.handleError(error.message);
  // æˆ–è€…é‡æ–°æŠ›å‡º
  throw error;
}
```

### Chrome APIè°ƒç”¨
```javascript
// ä½¿ç”¨PromiseåŒ…è£…Chrome API
const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
const result = await chrome.storage.local.get(['key']);
```

## æ¶ˆæ¯ä¼ é€’è§„èŒƒ

### æ¶ˆæ¯æ ¼å¼
```javascript
// å‘é€æ¶ˆæ¯
chrome.runtime.sendMessage({
  type: 'MESSAGE_TYPE',
  data: payload,
  site: window.location.hostname
});

// æ¥æ”¶æ¶ˆæ¯
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.type === 'MESSAGE_TYPE') {
    // å¤„ç†æ¶ˆæ¯
    sendResponse({ success: true });
  }
});
```

### å¼‚æ­¥å“åº”
```javascript
// å¯¹äºå¼‚æ­¥å“åº”ï¼Œè¿”å›trueä¿æŒé€šé“å¼€æ”¾
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === 'asyncAction') {
    handleAsyncAction().then(result => {
      sendResponse(result);
    });
    return true; // ä¿æŒæ¶ˆæ¯é€šé“å¼€æ”¾
  }
});
```

## çŠ¶æ€ç®¡ç†

### çŠ¶æ€æ›´æ–°æ¨¡å¼
```javascript
// æ›´æ–°çŠ¶æ€å¹¶åŒæ­¥åˆ°å­˜å‚¨
updateProgress(progress) {
  this.progress = progress;
  this.updateUI();
  
  // åŒæ­¥åˆ°å­˜å‚¨
  chrome.storage.local.set({
    progress: this.progress,
    lastUpdate: new Date().toISOString()
  });
}
```

### æ•°æ®æŒä¹…åŒ–
```javascript
// ä¿å­˜æ•°æ®
async saveData() {
  try {
    await chrome.storage.local.set({ 
      key: this.data 
    });
  } catch (error) {
    console.error('ä¿å­˜å¤±è´¥:', error);
  }
}

// åŠ è½½æ•°æ®
async loadData() {
  try {
    const result = await chrome.storage.local.get(['key']);
    if (result.key) {
      this.data = result.key;
    }
  } catch (error) {
    console.error('åŠ è½½å¤±è´¥:', error);
  }
}
```

## è°ƒè¯•å’Œæ—¥å¿—

### æ—¥å¿—è§„èŒƒ
```javascript
// ä½¿ç”¨è¡¨æƒ…ç¬¦å·å¢å¼ºæ—¥å¿—å¯è¯»æ€§
console.log('âœ… æ“ä½œæˆåŠŸ');
console.warn('âš ï¸ è­¦å‘Šä¿¡æ¯');
console.error('âŒ é”™è¯¯ä¿¡æ¯');
console.log('ğŸ­ æ¼”å‘˜ä¿¡æ¯æå–');
console.log('ğŸ“ æ–‡ä»¶ä¸‹è½½');
```

### è°ƒè¯•ä¿¡æ¯
```javascript
// è¯¦ç»†çš„çŠ¶æ€ä¿¡æ¯
console.log('çŠ¶æ€æ›´æ–°:', {
  isExtracting: this.isExtracting,
  progress: this.progress,
  urlsCount: this.urls.length
});
```

## æ€§èƒ½ä¼˜åŒ–

### æ•°æ®ç»“æ„é€‰æ‹©
```javascript
// ä½¿ç”¨Seté¿å…é‡å¤
this.extractedURLs = new Set();

// ä½¿ç”¨Mapå­˜å‚¨é”®å€¼å¯¹
this.parsers = new Map();
```

### å†…å­˜ç®¡ç†
```javascript
// åŠæ—¶æ¸…ç†å®šæ—¶å™¨
clearInterval(this.dataCheckInterval);

// æ¸…ç†DOMå¼•ç”¨
if (document.body.contains(element)) {
  document.body.removeChild(element);
}
```

## æ³¨é‡Šè§„èŒƒ

### å‡½æ•°æ³¨é‡Š
```javascript
/**
 * æå–å½“å‰é¡µé¢çš„ç›¸å†ŒURL
 * @param {Object} extractor - æå–å™¨å®ä¾‹
 * @returns {Array<string>} URLæ•°ç»„
 */
extractCurrentPageURLs(extractor = null) {
  // å®ç°
}
```

### å¤æ‚é€»è¾‘æ³¨é‡Š
```javascript
// æ£€æŸ¥æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ
// 1. æŸ¥æ‰¾åˆ†é¡µå…ƒç´ 
// 2. æ£€æŸ¥ä¸‹ä¸€é¡µé“¾æ¥çŠ¶æ€
// 3. éªŒè¯é“¾æ¥æœ‰æ•ˆæ€§
hasNextPage() {
  // å®ç°
}
```